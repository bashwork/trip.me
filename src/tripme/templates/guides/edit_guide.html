{% extends "base.html" %}

{% block content_title %}{{ guide.name }} by <a href="{{ guide.user.get_absolute_url }}">{{ guide.user.username }}</a>{% endblock %} 

{% block content %}

   <article class="grid_10 instructions">
     <p>This is some text that describes how to use this interface</p>
   </article>
   <figure class="grid_2">
     <button id="button-add-city">Add New City</button>
   </figure>
   <div class="clearfix"></div>

   <div class="grid_4">
     <ul id="city-list">
       {% for entry in guide.guidelocationentry_set.all %}
         <li class="edit-delete">
           <a href="{{ entry.city.get_absolute_url }}">{{ entry.city }}</a>
         </li>
       {% endfor %}
     </ul>
   </div>

   <figure class="grid_8">
     <div class="map-block large"></div>
   </figure>

{% endblock %}

{% block extra_javascript %}
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>

    <script>
    $(document).ready(function() {

      function do_add_city(city) {
          $("#city-list").append("<li>"+city+"</li>");
          $.gmaps.mark({ position : city });
      }

      $("#add-city-dialog input").autocomplete({
        source: function(request, response) {
          $.getJSON('http://ws.geonames.org/searchJSON',
          {
            style        : 'full',
            maxRows      : 10,
            featureClass : 'P',
            q            : request.term,
          }, function(data) {
            response($.map(data.geonames, function(item) {
              var result = item.name
                + (item.adminName1 ? ", " + item.adminName1 : "")
                + ", " + item.countryName;
              return { label : result, value : result };
            }));
          });
        }
      });

      $("#add-city-dialog").dialog({
          modal    : true,
          position : 'center',
          title    : 'Add A New City', 
	  	autoOpen : false,
          resizable : false,
          buttons : [
            {
              text  : "Add City",
              click : function() {
                $(this).dialog("close");
                do_add_city($("#add-city-dialog input").attr("value"));
              },
            },
            {
              text  : "Cancel",
              click : function() {
                $(this).dialog("close");s
              }
            },
          ],
      });

	  $("#button-add-city").button().click(function() {
        $("#add-city-dialog input").val('');
        $("#add-city-dialog").dialog('open');
	  });

      $(".map-block").gmaps();
    });
    </script>
{% endblock %}

{% block extra_dom %}

 <div id="add-city-dialog" title="Add A New City">
   <form> 
     <label for="search">Search</label> 
     <input type="search" placeholder="Where do you want to go?"/>
   </form> 
 </div>
 

{% endblock %}
